<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.css">
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.js"></script>

{% load static%}

<body>
    <button type="button" class="btn btn-danger" style="position: absolute; top: 20px; right: 20px; background-color:rgb(149, 77, 249);">
        <a href="{% url 'logout' %}" style=" color:white;">Logout</a>
    </button>

    <a href="{%url 'skill_dashboard'%}" style="position: absolute; top: 20px; left: 20px; font-size: 30px;"><i class="fa-solid fa-house"></i></a>


  <a href = "{% url 'export_review_data' %}" style="position: absolute; top: 70px; right: 20px;">Export Ratings Data</a>
  <a href = "{% url 'export_cert_data'%}" style= "position: absolute; top: 90px; right: 20px;">Export Certificate Data</a>
  <a href = "{% url 'admin_view_rated'%}" style= "position: absolute; top: 110px; right: 20px;">View rated data</a>
  
    <div style='text-align: center; border: 3px solid LightSteelBlue; background-color: #d5f1d3;'>
        <br>
        <br>
        <br> 
        <h4 style="color:rgb(149, 77, 249);">Skill Matrix Application</h4>

        
        <h3 class="text-success">Welcome Admin {{ user.get_username }}</h3>

    </div>


    <h4 style="text-align: center; padding: 20px;">Rate users under manager</h4>

<div>
    {% include 'user_skills/partials/_manager_rate_table.html' with unrated_skills_by_category=unrated_skills_by_category %}
</div>



<style>
    .fa-star { color: #808080; cursor: pointer; }
    .fa-solid { color: #f39c12; }
    .display_ratings_star{pointer-events: none;}
    .fa-circle-check{color:green; font-size: 20px;}
    .fa-circle-xmark{color:red; font-size: 20px;}

    .table_mgr{
        margin-left: auto;
        margin-right: auto;
        width:90%;
    }

    body {
        background-image:  url("{% static 'images/background.jpg' %}");
        background-size: cover; /* Ensure the image covers the entire page */
        background-position: center center; /* Center the image */
        background-repeat: no-repeat; /* Prevent the image from repeating */
        background-attachment: fixed; /* Fix the image when scrolling */
    }

    html, body {
        height: 100%; /* Make sure the body and html elements fill the full viewport height */
        margin: 0; /* Remove default margin */
    }

    .table_mgr {
        table-layout: fixed;
        width: 100%;

    }

    .fa-house{
        color:#07b80a;
    }
    
    
</style>


<script>
    $(document).on("click", ".fa-star", function () {
        var rating_id = $(this).data("rating-id");
        var rating = $(this).data("index");
        console.log()
        $.ajax({
            url: "{% url 'managerrateajax' %}",
            type: 'POST',
            data:{
                rating_id: rating_id,
                rating: rating,
                csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            success: function(response){
                if(response.success){
                    console.log("Rating updated successfully!");
                    //location.reload();
                    var ele = $('#rating_id'+rating_id).find('span').find('i').removeClass('fa-solid')
                    for(let i=0; i<rating; i++){
                        var ele = $('#rating_id'+rating_id).find('span').find('i').eq(i)
                        ele.addClass('fa-solid fa-star');
                    }

                    $("#mgr_rvw"+rating_id).find('i').removeClass('fa-circle-xmark')
                    $("#mgr_rvw"+rating_id).find('i').addClass('fa-circle-check')


                }
            }
        })
    });


    document.addEventListener('DOMContentLoaded', function () {

        const trElements = document.querySelectorAll('tr');
        
        const uniqueClassNames = new Set();
        trElements.forEach(function(tr) {
            // Get the class names of the current <tr> element
            const classes = tr.classList;
    
            // Add each class name to the Set (duplicates will be automatically ignored)
            classes.forEach(className => uniqueClassNames.add(className));
        });

        var ctr = 0
        uniqueClassNames.forEach(function(cname){ 
            const elements = document.getElementsByClassName(cname);  // Select all elements with that class name

        // Apply alternating background color for <td> elements within each <tr>
        for (let i = 0; i < elements.length; i++) {
            // Select all <td> elements within the current <tr>
            const tdElements = elements[i].getElementsByTagName('td');
            
            // Loop through each <td> element and apply alternating background colors
            for (let j = 0; j < tdElements.length; j++) {
                if (ctr % 2 === 0) {
                    tdElements[j].style.backgroundColor = '#FFEECF';  // Even => yellow
                } else {
                    tdElements[j].style.backgroundColor = '#BFFFF1';     // Odd => red
                }
            }
        }
            ctr++;
        })

    });



    $(document).ready(function() {
        var table = $('.table_mgr').DataTable({
            "searching": true,  
            "ordering": false,  
            "responsive": true, 
            "paging": false
        });
    
        table.columns().every(function() {
            var column = this;
            var title = column.header().textContent; 
            
            var input = document.createElement('input');
            input.placeholder = 'Search ' + title;
            input.className = 'column-search'; 
            
            $(column.header()).html(input);
    
            $(input).on('keyup', function() {
                column.search($(this).val()).draw();
            });
        });
    });
</script>